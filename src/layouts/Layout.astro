---
import "../styles/global.css";
import noise from "../assets/noise-light.png";
import noiseDark from "../assets/noise-dark.png";
import "@fontsource/geist-mono";
import "@fontsource/geist-sans";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";

// Script to manage dark mode preferences
const getThemePreference = () => {
	if (typeof localStorage !== "undefined" && localStorage.getItem("theme")) {
		return localStorage.getItem("theme");
	}
	return window.matchMedia("(prefers-color-scheme: dark)").matches
		? "dark"
		: "light";
};
---

<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<meta name="generator" content={Astro.generator} />
		<title>Pere Montpe√≥</title>
		<script is:inline>
			// On page load or when changing themes, best to add inline in `head` to avoid FOUC
			const getThemePreference = () => {
				if (
					typeof localStorage !== "undefined" &&
					localStorage.getItem("theme")
				) {
					return localStorage.getItem("theme");
				}
				return window.matchMedia("(prefers-color-scheme: dark)").matches
					? "dark"
					: "light";
			};

			const theme = getThemePreference();

			if (theme === "dark") {
				document.documentElement.classList.add("dark");
			} else {
				document.documentElement.classList.remove("dark");
			}
		</script>
	</head>
	<body>
		<Header />
		<slot />
		<Footer />
		<button
			id="theme-toggle"
			aria-label="Toggle dark mode"
			class="theme-toggle"
		>
			<span class="sr-only">Toggle theme</span>
			<svg
				xmlns="http://www.w3.org/2000/svg"
				width="24"
				height="24"
				viewBox="0 0 24 24"
				fill="none"
				stroke="currentColor"
				stroke-width="2"
				stroke-linecap="round"
				stroke-linejoin="round"
				class="theme-toggle-icon sun-icon"
				><circle cx="12" cy="12" r="5"></circle><line
					x1="12"
					y1="1"
					x2="12"
					y2="3"></line><line x1="12" y1="21" x2="12" y2="23"
				></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"
				></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"
				></line><line x1="1" y1="12" x2="3" y2="12"></line><line
					x1="21"
					y1="12"
					x2="23"
					y2="12"></line><line
					x1="4.22"
					y1="19.78"
					x2="5.64"
					y2="18.36"></line><line
					x1="18.36"
					y1="5.64"
					x2="19.78"
					y2="4.22"></line></svg
			>
			<svg
				xmlns="http://www.w3.org/2000/svg"
				width="24"
				height="24"
				viewBox="0 0 24 24"
				fill="none"
				stroke="currentColor"
				stroke-width="2"
				stroke-linecap="round"
				stroke-linejoin="round"
				class="theme-toggle-icon moon-icon"
				><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"
				></path></svg
			>
		</button>
	</body>
</html>

<script>
	// Theme toggle functionality
	document.addEventListener("DOMContentLoaded", () => {
		const themeToggle = document.getElementById("theme-toggle");

		if (themeToggle) {
			themeToggle.addEventListener("click", () => {
				// Toggle the class
				document.documentElement.classList.toggle("dark");

				// Update localStorage
				const isDark =
					document.documentElement.classList.contains("dark");
				localStorage.setItem("theme", isDark ? "dark" : "light");
			});
		}
	});
</script>

<style
	define:vars={{
		noiseUrl: `url(${noise.src})`,
		noiseDarkUrl: `url(${noiseDark.src})`,
	}}
>
	body {
		background-image: var(--noiseUrl);
		background-size: auto;
		background-repeat: repeat;
		background-attachment: scroll;
		background-clip: border-box;
		background-origin: padding-box;
		background-position: 0 0;
		background-color: var(--background);
	}

	.dark body {
		background-image: var(--noiseDarkUrl);
	}

	.theme-toggle {
		position: fixed;
		bottom: 1rem;
		right: 1rem;
		background-color: var(--primary);
		color: var(--primary-foreground);
		border: none;
		border-radius: var(--radius);
		padding: 0.5rem;
		cursor: pointer;
		display: flex;
		align-items: center;
		justify-content: center;
		z-index: 100;
		box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
	}

	.theme-toggle-icon {
		width: 1.5rem;
		height: 1.5rem;
	}

	.sun-icon {
		display: none;
	}

	.moon-icon {
		display: block;
	}

	html.dark .sun-icon {
		display: block;
	}

	html.dark .moon-icon {
		display: none;
	}
</style>
